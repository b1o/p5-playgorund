webpackJsonp([0],{"+PwK":function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=i("LMZF"),o=function(){},e=i("0nO6"),r=function(){function t(t,n){var i=this;this.rows=t,this.cols=n,this.data=new Array(this.rows).fill(0).map(function(){return new Array(i.cols).fill(0)})}return t.fromArray=function(n){return new t(n.length,1).map(function(t,i){return n[i]})},t.subtract=function(n,i){if(n.rows===i.rows&&n.cols===i.cols)return new t(n.rows,n.cols).map(function(t,s,o){return n.data[s][o]-i.data[s][o]});console.log("Columns and Rows of A must match Columns and Rows of B.")},t.transpose=function(n){return new t(n.cols,n.rows).map(function(t,i,s){return n.data[s][i]})},t.multiply=function(n,i){if(n.cols===i.rows)return new t(n.rows,i.cols).map(function(t,s,o){for(var e=0,r=0;r<n.cols;r++)e+=n.data[s][r]*i.data[r][o];return e});console.log("Columns of A must match rows of B.")},t.map=function(n,i){return new t(n.rows,n.cols).map(function(t,s,o){return i(n.data[s][o],s,o)})},t.deserialize=function(n){"string"==typeof n&&(n=JSON.parse(n));var i=new t(n.rows,n.cols);return i.data=n.data,i},t.prototype.copy=function(){for(var n=new t(this.rows,this.cols),i=0;i<this.rows;i++)for(var s=0;s<this.cols;s++)n.data[i][s]=this.data[i][s];return n},t.prototype.toArray=function(){for(var t=[],n=0;n<this.rows;n++)for(var i=0;i<this.cols;i++)t.push(this.data[n][i]);return t},t.prototype.randomize=function(){return this.map(function(t){return 2*Math.random()-1})},t.prototype.add=function(n){return n instanceof t?this.rows!==n.rows||this.cols!==n.cols?void console.log("Columns and Rows of A must match Columns and Rows of B."):this.map(function(t,i,s){return t+n.data[i][s]}):this.map(function(t){return t+n})},t.prototype.multiply=function(n){return n instanceof t?this.rows!==n.rows||this.cols!==n.cols?void console.log("Columns and Rows of A must match Columns and Rows of B."):this.map(function(t,i,s){return t*n.data[i][s]}):this.map(function(t){return t*n})},t.prototype.map=function(t){t instanceof Function||console.log(t);for(var n=0;n<this.rows;n++)for(var i=0;i<this.cols;i++)this.data[n][i]=t(this.data[n][i],n,i);return this},t.prototype.print=function(){return console.table(this.data),this},t.prototype.serialize=function(){return JSON.stringify(this)},t}(),h=function(t,n){this.func=t,this.dfunc=n},a=new h(function(t){return 1/(1+Math.exp(-t))},function(t){return t*(1-t)}),u=(new h(function(t){return Math.tanh(t)},function(t){return 1-t*t}),function(){function t(n,i,s){n instanceof t?(this.input_nodes=n.input_nodes,this.hidden_nodes=n.hidden_nodes,this.output_nodes=n.output_nodes,this.weights_ih=n.weights_ih.copy(),this.weights_ho=n.weights_ho.copy(),this.bias_h=n.bias_h.copy(),this.bias_o=n.bias_o.copy()):(this.input_nodes=n,this.hidden_nodes=i,this.output_nodes=s,this.weights_ih=new r(this.hidden_nodes,this.input_nodes),this.weights_ho=new r(this.output_nodes,this.hidden_nodes),this.weights_ih.randomize(),this.weights_ho.randomize(),this.bias_h=new r(this.hidden_nodes,1),this.bias_o=new r(this.output_nodes,1),this.bias_h.randomize(),this.bias_o.randomize()),this.setLearningRate(),this.setActivationFunction()}return t.deserialize=function(n){"string"==typeof n&&(n=JSON.parse(n));var i=new t(n.input_nodes,n.hidden_nodes,n.output_nodes);return i.weights_ih=r.deserialize(n.weights_ih),i.weights_ho=r.deserialize(n.weights_ho),i.bias_h=r.deserialize(n.bias_h),i.bias_o=r.deserialize(n.bias_o),i.learning_rate=n.learning_rate,i},t.prototype.predict=function(t){var n=r.fromArray(t),i=r.multiply(this.weights_ih,n);i.add(this.bias_h),i.map(this.activation_function.func);var s=r.multiply(this.weights_ho,i);return s.add(this.bias_o),s.map(this.activation_function.func),s.toArray()},t.prototype.setLearningRate=function(t){void 0===t&&(t=.1),this.learning_rate=t},t.prototype.setActivationFunction=function(t){void 0===t&&(t=a),this.activation_function=t},t.prototype.train=function(t,n){var i=r.fromArray(t),s=r.multiply(this.weights_ih,i);s.add(this.bias_h),s.map(this.activation_function.func);var o=r.multiply(this.weights_ho,s);o.add(this.bias_o),o.map(this.activation_function.func);var e=r.fromArray(n),h=r.subtract(e,o),a=r.map(o,this.activation_function.dfunc);a.multiply(h),a.multiply(this.learning_rate);var u=r.transpose(s),l=r.multiply(a,u);this.weights_ho.add(l),this.bias_o.add(a);var p=r.transpose(this.weights_ho),c=r.multiply(p,h),d=r.map(s,this.activation_function.dfunc);d.multiply(c),d.multiply(this.learning_rate);var f=r.transpose(i),g=r.multiply(d,f);this.weights_ih.add(g),this.bias_h.add(d)},t.prototype.serialize=function(){return JSON.stringify(this)},t.prototype.copy=function(){return new t(this)},t.prototype.mutate=function(t){this.weights_ih.map(t),this.weights_ho.map(t),this.bias_h.map(t),this.bias_o.map(t)},t}()),l=function(){return function(t){this.dir=p5.Vector.fromAngle(t),this.val=0}}(),p=function(){function t(t,n){this.p=t,this.gravity=.6,this.lift=-20,this.alive=!0,this.score=1,this.fitness=0,this.visionRadius=160,this.health=2,this.maxHealth=3,this.minSpeed=.25,this.maxSpeed=5,this.totalSensors=8,this.foodEaten=0,this.sensorAngle=2*Math.PI/this.totalSensors,this.mutationRate=.1,this.sensors=[];for(var i=0;i<this.p.TWO_PI;i+=this.sensorAngle)this.sensors.push(new l(i));n instanceof u?(this.brain=n,this.brain.mutate(this.mutate.bind(this))):this.brain=new u(this.sensors.length+7,32,2),this.pos=this.p.createVector(this.p.random(200,this.p.width-200),this.p.random(200,this.p.height-200)),this.velocity=this.p.createVector(0,0),this.acc=this.p.createVector(0,0)}return t.prototype.mutate=function(t){return this.p.random(1)<this.mutationRate?t+.5*this.p.randomGaussian():t},t.prototype.think=function(t){if(this.alive){for(var n=0;n<this.sensors.length;n++)this.sensors[n].val=150;for(var i=0;i<t.length;i++){var s=t[i],o=p5.Vector.dist(this.pos,s);if(!(o>150)){var e=p5.Vector.sub(s,this.pos);for(n=0;n<this.sensors.length;n++)this.sensors[n].dir.angleBetween(e)<this.sensorAngle/2&&(this.sensors[n].val=this.p.min(this.sensors[n].val,o))}}var r=[];for(r[0]=this.p.constrain(this.p.map(this.pos.x,200,0,0,1),0,1),r[1]=this.p.constrain(this.p.map(this.pos.y,200,0,0,1),0,1),r[2]=this.p.constrain(this.p.map(this.pos.x,this.p.width-200,this.p.width,0,1),0,1),r[3]=this.p.constrain(this.p.map(this.pos.y,this.p.height-200,this.p.height,0,1),0,1),r[4]=this.velocity.x/this.maxSpeed,r[5]=this.velocity.y/this.maxSpeed,r[6]=this.foodEaten/50,n=0;n<this.sensors.length;n++)r[n+7]=this.p.map(this.sensors[n].val,0,150,1,0);var h=this.brain.predict(r),a=this.p.createVector(2*h[0]-1,2*h[1]-1);a.mult(this.maxSpeed);var u=p5.Vector.sub(a,this.velocity);u.limit(.5),this.acc.add(u)}},t.prototype.copy=function(){return new t(this.p,this.brain)},t.prototype.eat=function(t){for(var n=t.length-1;n>=0;n--)p5.Vector.dist(t[n],this.pos)<8&&(t.splice(n,1),this.score+=100,this.foodEaten++,this.health++)},t.prototype.update=function(t){this.velocity.add(this.acc),this.velocity.limit(this.maxSpeed),this.velocity.mag()<this.minSpeed&&this.velocity.setMag(this.minSpeed),this.pos.add(this.velocity),this.acc.mult(0),this.health=this.p.constrain(this.health,0,this.maxHealth),this.health-=.005,this.score++,this.health<0&&(this.alive=!1,this.score-=100),this.pos.y>this.p.height&&(this.score-=100,this.alive=!1),this.pos.y<0&&(this.score-=100,this.alive=!1),this.pos.x>this.p.width&&(this.score-=100,this.alive=!1),this.pos.x<0&&(this.score-=100,this.alive=!1)},t.prototype.up=function(){this.velocity+=this.lift},t.prototype.show=function(){this.p.fill(255,255,255,50),this.p.ellipse(this.pos.x,this.pos.y,32,32),this.p.fill(255),this.p.rect(this.pos.x-16,this.pos.y,this.p.map(this.health,0,this.maxHealth,0,32),2),this.p.textSize(10),this.p.text(this.score,this.pos.x,this.pos.y),this.p.fill(0,102,153)},t}(),c=function(){function t(t,n,i){this.p=t,this.birds=n,this.total=i,this.currentBestAvrgFitness=0,this.generationsCount=0,this.maxGenerationsWithNoImprovement=20,this.generationsSinceBestOne=0}return t.prototype.nextGeneration=function(t){this.generationsCount++,t=this.caluclateFitness(t);for(var n=[],i=0;i<t.length;i++)n[i]=this.pickOne(t);return n},t.prototype.pickOne=function(t){for(var n=0,i=this.p.random(1);i>0;)i-=t[n].fitness,n++;return t[--n].copy()},t.prototype.caluclateFitness=function(t){for(var n,i=0,s=0,o=t;s<o.length;s++)(h=o[s]).score=this.p.pow(h.score,2),i+=h.score;for(var e=0,r=t;e<r.length;e++){var h;(h=r[e]).fitness=h.score/i}return i>this.currentBestAvrgFitness&&(this.currentBestAvrgFitness=i,this.currentBestGeneration=t,console.log("new best",this.currentBestGeneration),this.generationsSinceBestOne=0),n=t,console.log("best avrg fitness",this.currentBestAvrgFitness/this.currentBestGeneration.length),console.log("current avrg fitness",i/t.length),n},t}(),d=function(){function t(){this.population=50,this.cylces=1,this.food=[],this.runningBest=!1,this.trainingData=[{inputs:[0,0],targets:[0]},{inputs:[1,0],targets:[1]},{inputs:[0,1],targets:[1]},{inputs:[1,1],targets:[0]}]}return t.prototype.generateFood=function(){for(var t=0;t<50;t++)this.food.push(this.p.createVector(this.p.random(200,this.p.width-200),this.p.random(200,this.p.height-200)))},t.prototype.drawing=function(t){var n=this;this.p=t,this.p.setup=function(){n.p.createCanvas(window.innerWidth,window.innerHeight),n.p.background(0),n.birds=new Array,n.food=[];for(var t=0;t<n.population;t++)n.birds.push(new p(n.p,n.p.random(n.p.width)));n.ga=new c(n.p,n.birds,n.population)},this.p.draw=function(){for(var t=0;t<n.cylces;t++){for(;n.food.length<50;)n.food.push(n.p.createVector(n.p.random(200,n.p.width-200),n.p.random(200,n.p.height-200)));for(var i=0,s=n.birds;i<s.length;i++)(u=s[i]).alive&&(u.eat(n.food),u.think(n.food),u.update(n.food));n.birds.filter(function(t){return t.alive}).length<=0&&(n.birds=n.runningBest?n.ga.currentBestGeneration.map(function(t){return new p(n.p,t.brain)}):n.ga.nextGeneration(n.birds))}n.p.background(0);for(var o=0,e=n.food;o<e.length;o++){var r=e[o];n.p.stroke(255),n.p.point(r.x,r.y)}for(var h=0,a=n.birds;h<a.length;h++){var u;(u=a[h]).alive&&u.show()}}},t.prototype.ngOnInit=function(){this.p5=new p5(this.drawing.bind(this))},t}(),f=s.Z({encapsulation:0,styles:[[""]],data:{}});function g(t){return s._17(0,[(t()(),s._16(-1,null,["\n"])),(t()(),s._1(1,0,null,null,12,"div",[["style","position: fixed; bottom:0; right:0; margin: 20px;"]],null,null,null,null,null)),(t()(),s._16(-1,null,["\n  "])),(t()(),s._1(3,0,null,null,6,"input",[["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],function(t,n,i){var o=!0,e=t.component;return"input"===n&&(o=!1!==s._11(t,4)._handleInput(i.target.value)&&o),"blur"===n&&(o=!1!==s._11(t,4).onTouched()&&o),"compositionstart"===n&&(o=!1!==s._11(t,4)._compositionStart()&&o),"compositionend"===n&&(o=!1!==s._11(t,4)._compositionEnd(i.target.value)&&o),"change"===n&&(o=!1!==s._11(t,5).onChange(i.target.value)&&o),"input"===n&&(o=!1!==s._11(t,5).onChange(i.target.value)&&o),"blur"===n&&(o=!1!==s._11(t,5).onTouched()&&o),"ngModelChange"===n&&(o=!1!==(e.cylces=i)&&o),o},null,null)),s._0(4,16384,null,0,e.b,[s.B,s.k,[2,e.a]],null,null),s._0(5,16384,null,0,e.i,[s.B,s.k],null,null),s._13(1024,null,e.d,function(t,n){return[t,n]},[e.b,e.i]),s._0(7,671744,null,0,e.g,[[8,null],[8,null],[8,null],[2,e.d]],{model:[0,"model"]},{update:"ngModelChange"}),s._13(2048,null,e.e,null,[e.g]),s._0(9,16384,null,0,e.f,[e.e],null,null),(t()(),s._16(-1,null,["\n  "])),(t()(),s._1(11,0,null,null,1,"button",[],null,[[null,"click"]],function(t,n,i){var s=!0,o=t.component;return"click"===n&&(s=0!=(o.runningBest=!o.runningBest)&&s),s},null,null)),(t()(),s._16(12,null,["",""])),(t()(),s._16(-1,null,["\n"])),(t()(),s._16(-1,null,["\n"]))],function(t,n){t(n,7,0,n.component.cylces)},function(t,n){var i=n.component;t(n,3,0,s._11(n,9).ngClassUntouched,s._11(n,9).ngClassTouched,s._11(n,9).ngClassPristine,s._11(n,9).ngClassDirty,s._11(n,9).ngClassValid,s._11(n,9).ngClassInvalid,s._11(n,9).ngClassPending),t(n,12,0,i.runningBest?"Continue":"Toggle best generation")})}var m=s.X("app-perceptron",d,function(t){return s._17(0,[(t()(),s._1(0,0,null,null,1,"app-perceptron",[],null,null,null,g,f)),s._0(1,114688,null,0,d,[],null,null)],function(t,n){t(n,1,0)},null)},{},{},[]),_=i("Un6q"),v=i("UHIZ"),w=function(){};i.d(n,"NeuralNetworkModuleNgFactory",function(){return y});var y=s.Y(o,[],function(t){return s._8([s._9(512,s.j,s.V,[[8,[m]],[3,s.j],s.v]),s._9(4608,_.i,_.h,[s.s,[2,_.m]]),s._9(4608,e.j,e.j,[]),s._9(512,_.b,_.b,[]),s._9(512,e.h,e.h,[]),s._9(512,e.c,e.c,[]),s._9(512,v.m,v.m,[[2,v.r],[2,v.k]]),s._9(512,w,w,[]),s._9(512,o,o,[]),s._9(1024,v.i,function(){return[[{path:"",pathMatch:"full",redirectTo:"perceptron"},{path:"perceptron",component:d}]]},[])])})}});